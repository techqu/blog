---
title: "Java虚拟机是如何加载Java类的?"
date: 2018-12-24T15:46:28+08:00
draft: false
author: "瞿广"
originallink: ""
summary: "。"
tags: ["java"]
categories: ["Tech"]
---

>  Java虚拟机是如何加载Java类的?

从class文件到内存中的类，按先后顺序需要经过**加载、链接、以及初始化**三大步骤。

![类加载过程](/img/class-life.jpeg)

其中，链接过程中同样需要验证；而内存中的类没有经过初始化，同样不能使用。
基本类型和引用类型
- 基本类型，是由Java虚拟机预先定义好的。
- 另一大类引用类型，Java将其分为四种：类、接口、数组类和泛型参数（泛型参数会在编译过程中被擦除），因此Java虚拟机实际上只有前三种。

在类、接口和数组类中，数组类是由Java虚拟机直接生成的，其他两种则由其对应的字节流。

字节流，最常见的形式要属由Java编译器生成的class文件

### 步骤一：加载
是指查找字节流，并且据此创建类的过程。
#### 类加载器，双亲委派模型
**启动类加载器（boot class loader）**：c++实现的
其他类都是`java.lang.ClassLoader` 的子类，都需要先由启动类加载器，加载至Java虚拟机中，方能执行类加载。


**扩展类加载器（父类是启动类加载器）**：加载相对次要、但又通用的类，比如存放在JRE的lib/ext目录下jar包中的类（以及由系统变量java.ext.dirs指定的类）


**应用类加载器的父类加载器则是扩展类加载器**。它负责加载应用程序路径下的类。

双亲委派模型：每当一个类加载器接收到加载请求时，它会先将请求转发给父类加载器。在父类加载器没有找到所请求的类的情况下，该类加载器才会尝试去加载

![类加载过程](/img/class-loader-sort.png)

### 步骤二：链接
是指将创建的类合并至Java虚拟机中，使之能够执行的过程。
#### 1.验证阶段
确保加载类能够满足Java虚拟机的约束条件
#### 2.准备阶段
为被加载类的静态字段分配内存，类变量赋默认值
#### 3.解析阶段
非必须（动态绑定）

### 步骤三：初始化